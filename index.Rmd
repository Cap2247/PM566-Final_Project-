---
title: "Mental health service utilization during COVID-19 Pandemic"
author: "Camille Parchment"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

This is my PM566 Final Project website.

<br>

```{r, message=FALSE, echo=FALSE, warning=FALSE}
# Initialize code chunk options
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px")
```

```{r setup, message=FALSE, echo=FALSE, warning=FALSE}
library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)
```

# Database 

The Household Pulse Survey (HPS) is a self-report online survey which measures in real time the social and economic impacts of the COVID-19 pandemic. In this study we analyzed HPS data from week 18,  October 28, 2021 â€“ November 9, 2021. 

# Study Sample

Our study sample were all individuals who needed mental health services and either received services or did not between October 28, 2021, and November 9, 2021.  Mental health services were   

```{r echo=FALSE}
source("mental_health_data.R")

private.insurance <- DF4 %>% 
                     plot_ly(x = ~Total_sv_needed, y = ~num_notrec, 
                     type = 'scatter',
                     mode = 'markers',
                     color = ~state,
                     colors = "Purples")
private.insurance <- private.insurance %>% layout(title = 'Mental health services requested and not recieved by state and private insurance ',
                                                xaxis = list(title = 'Total services requested'),
                                                yaxis = list(title = 'Number of services not recived'))


public.insurance <- DF2 %>% 
                     plot_ly(x = ~Total_sv_needed, y = ~num_notrec, 
                     type = 'scatter',
                     mode = 'markers',
                     color = ~state,
                     colors = "Reds")
public.insurance <- public.insurance %>% layout(title = 'Mental health services requested and not recieved by state and insurance type',
                                                xaxis = list(title = 'Total services requested'),
                                                yaxis = list(title = 'Number of services not recived'))

 income <- plot_ly(x = ~income.data$income, y = ~income.data$num_notrec.x, 
                   type = 'bar',
                   name = 'Private Insurance')
income <- income %>% add_trace( y= ~income.data$num_notrec.y, name = "Public Insurance" )
income <- income %>% layout( title = 'Mental health services requested and not recived by income and insurance type',
                             yaxis = list( title = 'Number of services requested and not received'), barmode = 'group',
                             xaxis = list (title = "Income"),
                             color = ~income,
                            colors = "Blues")

map.data$hover <- with(map.data, paste(state, '<br>', tot.notrec.rate, " % services not received " ))



l <- list(color = toRGB("white"), width=2)


g <- list(
     scope = 'usa',
     projection = list(type = 'albers usa'),
     showlakes = TRUE, 
     lakecolor = toRGB('white')
)




fig <- plot_geo(state_data.comp, 
               locationmode = 'USA-states')



fig <- fig %>% add_trace (z = ~map.data$total.needed,    
           text = ~map.data$hover,
       locations = ~map.data$usa_state_code,
           color = ~map.data$Notrec_rate,
          colors = 'Purples' )

              


fig <- fig  %>% layout (title = "Rate of total Mental Health Services Requested and Not Received by state and insurance",
         geo =g )
         


```


## Plots {.tabset}

### Tab 1

```{r echo=FALSE}
private.insurance
```

### Tab 2

```{r echo=FALSE}
public.insurance
```

### Tab 3
```{r echo= FALSE}
income 
```

### Tab 4

```{r echo=FALSE}
fig
```

## {-}
